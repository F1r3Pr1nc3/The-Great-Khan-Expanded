# Use in war scope. War is deleted.
# Prev = war_participant
# Vanilla Fix: don't break the loop
end_war_effect = {
	# every_war_participant = {
	if = { # is defenders
		# because strange log behavior
		limit = {
			exists = this
			is_scope_valid = yes
			is_scope_type = war
			count_attacker = {
				count > 0
				# limit = {  }
			}
		}
		every_attacker = {
			limit = {
				# NOT = { is_same_empire = prevprev }
				# NOT = { is_war_participant = { war = prev side = prevprev } }
				is_war_participant = { war = prev side = attackers } # because strange log behavior
			}
			prev = { remove_war_participant = prev }
			if = { # seems superflous
				limit = {
					NAND = {
						exists = prev
						prev = { is_scope_type = war }
					}
				}
				break = yes
			}
		}
		if = { # is defenders
			limit = {
				exists = this
				is_scope_valid = yes
				is_scope_type = war
				count_war_participants = {
					count > 0
					# limit = {  }
					side = prev
				}
				prev = { is_war_participant = { who = prev side = prevprev } }
			}
			remove_war_participant = prev
		}
	}
}
